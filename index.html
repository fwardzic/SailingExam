<!DOCTYPE html>
<html>
<head>
    <title>Learning Test Questions</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <style>
        .container {
            text-align: center;
            margin-top: 50px;
            font-size: 18px;
        }
        .question {
            margin-bottom: 20px;
        }
        .answers {
            margin-bottom: 20px;
        }
        .feedback {
            margin-bottom: 20px;
        }
        .next-button {
            margin-bottom: 20px;
        }
        .search-button {
            margin-bottom: 20px;
        }
        .hint {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="question" id="question"></div>
        <div id="imageContainer">
            <img id="questionImage" src="" alt="Question Image">
        </div>
        <div class="answers">
            <label for="answerA"><input type="radio" name="answer" value="A" id="answerA"> <span id="labelA"></span></label><br>
            <label for="answerB"><input type="radio" name="answer" value="B" id="answerB"> <span id="labelB"></span></label><br>
            <label for="answerC"><input type="radio" name="answer" value="C" id="answerC"> <span id="labelC"></span></label><br>
        </div>
        <button class="btn btn-primary" onclick="checkAnswer()">Check Answer</button>
        <div class="feedback" id="feedback"></div>
        <div class="hint" id="hint"></div>
        <button class="btn btn-primary" onclick="nextQuestion()">Next</button>
        <button class="btn btn-primary" onclick="searchQuestion()">Search in Google</button>
        <button class="btn btn-primary" onclick="showHint()" id="hintButton" style="display: none;">Show Hint</button>
        <p>Total Questions: <span id="totalQuestions">0</span></p>
        <p>Correct Answers: <span id="correctAnswers">0</span></p>
        <p>Correct Answers Percentage: <span id="percentage">0%</span></p> 
        <button class="btn btn-primary" onclick="resetStatistics()">Reset statistics</button>     
    </div>

    <script>
        var questions = [];
        var currentQuestionIndex = -1;
        var feedbackElement = document.getElementById("feedback");
        var hintElement = document.getElementById("hint");
        const localStorageStatsKey = "sailingExamQuizStatistics";
        var answerCheckedFirstTime = true;

        function displayQuestion() {
            var questionElement = document.getElementById("question");
            var labelA = document.getElementById("labelA");
            var labelB = document.getElementById("labelB");
            var labelC = document.getElementById("labelC");
            labelA.style.color = "";
            labelB.style.color = "";
            labelC.style.color = "";

            if (currentQuestionIndex >= 0 && currentQuestionIndex < questions.length) {
                const currentQuestion = questions[currentQuestionIndex];
                questionElement.textContent = currentQuestion.question;
                labelA.textContent = currentQuestion.answerA;
                labelB.textContent = currentQuestion.answerB;
                labelC.textContent = currentQuestion.answerC;
                feedbackElement.textContent = "";
                hintElement.textContent = "";
                clearSelectedAnswer();
                // Check if image properties exist
                if (currentQuestion.questionImage) {
                    // Set the image source and value
                    const questionImage = document.getElementById("questionImage");
                    questionImage.src = currentQuestion.questionImage;
                    // Show the image container
                    const imageContainer = document.getElementById("imageContainer");
                    imageContainer.style.display = "block";
                    imageContainer.style.maxHeight = "20em";
                    questionImage.style.maxHeight = "20em";
                } else {
                    // Hide the image container
                    const imageContainer = document.getElementById("imageContainer");
                    imageContainer.style.display = "none";
                }
                // Toggle the visibility of the "Show Hint" button
                const hintButton = document.getElementById("hintButton");
                if (currentQuestion.hint) {
                    hintButton.style.display = "inline-block";
                } else {
                    hintButton.style.display = "none";
                }
            } else {
                console.error(`currentQuestionIndex out of available questions: got ${currentQuestionIndex} where have ${questions.length} questions `)
            }
        }

        function checkAnswer() {
            var selectedAnswer = getSelectedAnswer();
            var currentQuestion = questions[currentQuestionIndex];
            const questionAnswerIsCorrect = selectedAnswer === currentQuestion.correctAnswer

            feedbackElement.textContent = questionAnswerIsCorrect ? "Correct!" : `Incorrect. The correct answer is ${currentQuestion.correctAnswer}`

            if (answerCheckedFirstTime) {
                updateStatistics(questionAnswerIsCorrect)
                answerCheckedFirstTime = false;
            }
            showHint();
            highlightCorrectAnswer();
        }

        function nextQuestion() {
            var randomDecimal = Math.random();
            var randomInRange = Math.floor(randomDecimal * questions.length);
            if (currentQuestionIndex === randomInRange) {
                currentQuestionIndex = randomInRange + 1;
            } else {
                currentQuestionIndex = randomInRange
            }
            answerCheckedFirstTime = true;
            displayQuestion();
        }

        function getSelectedAnswer() {
            var answerElements = document.getElementsByName("answer");

            for (var i = 0; i < answerElements.length; i++) {
                if (answerElements[i].checked) {
                    return answerElements[i].value;
                }
            }

            return null;
        }

        function clearSelectedAnswer() {
            var answerElements = document.getElementsByName("answer");

            for (var i = 0; i < answerElements.length; i++) {
                answerElements[i].checked = false;
            }
        }

        function highlightCorrectAnswer() {
            var selectedAnswer = getSelectedAnswer();
            var currentQuestion = questions[currentQuestionIndex];
            var labelA = document.getElementById("labelA");
            var labelB = document.getElementById("labelB");
            var labelC = document.getElementById("labelC");

            if (selectedAnswer === "A") {
                labelA.style.color = currentQuestion.correctAnswer === "A" ? "green" : "red";
            } else {
                labelA.style.color = "";
            }

            if (selectedAnswer === "B") {
                labelB.style.color = currentQuestion.correctAnswer === "B" ? "green" : "red";
            } else {
                labelB.style.color = "";
            }

            if (selectedAnswer === "C") {
                labelC.style.color = currentQuestion.correctAnswer === "C" ? "green" : "red";
            } else {
                labelC.style.color = "";
            }
        }

        function searchQuestion() {
            var currentQuestion = questions[currentQuestionIndex];
            var googleSearchUrl = "https://www.google.com/search?q=" + encodeURIComponent(currentQuestion.question);
            window.open(googleSearchUrl, "_blank");
        }

        // Function to show the hint
        function showHint() {
            const currentQuestion = questions[currentQuestionIndex];
            const hint = currentQuestion.hint != undefined ? currentQuestion.hint : "No hint for given question";
            document.getElementById("hint").textContent = hint;
        }

        function retrieveOrInitStatistics() {
            const localStorageStats = localStorage.getItem(localStorageStatsKey);
            if (localStorageStats) {
                return JSON.parse(localStorageStats);
            } else {
                const statistics = {
                    totalQuestions: 0,
                    correctAnswers: 0
                };
                localStorage.setItem(localStorageStatsKey, JSON.stringify(statistics));
                return statistics;
            }
        }

        function displayStatistic(statistics) {
            // Calculate the percentage of correct answers
            const percentage = (statistics.correctAnswers / statistics.totalQuestions) * 100;
            // Display the statistics
            document.getElementById("totalQuestions").textContent = statistics.totalQuestions;
            document.getElementById("correctAnswers").textContent = statistics.correctAnswers;
            document.getElementById("percentage").textContent = percentage.toFixed(2) + "%";
        }

        // Function to update and display the statistics
        function updateStatistics(questionAnswerIsCorrect) {
            // Retrieve statistics from local storage
            const statistics = retrieveOrInitStatistics();

            // Update the statistics
            statistics.totalQuestions++;
            if (questionAnswerIsCorrect) {
                statistics.correctAnswers++;
            }

            // Store the updated statistics in local storage
            localStorage.setItem(localStorageStatsKey, JSON.stringify(statistics));
            displayStatistic(statistics);
        }

        // Reset the statistics
        function resetStatistics() {
            const statistics = {
                totalQuestions: 0,
                correctAnswers: 0
            };
            localStorage.setItem(localStorageStatsKey, JSON.stringify(statistics));
            displayStatistic(statistics);
        }

        function fetchQuizDataAndStart() {
            fetch("https://raw.githubusercontent.com/sebarys/SailingExam/main/questions.json")
                .then((response) => response.json())
                .then((data) => {
                    questions = data;
                    retrieveOrInitStatistics();
                    nextQuestion();
                })
                .catch((error) => {
                    console.log("Error fetching quiz data:", error);
                });
        }

        fetchQuizDataAndStart();
    </script>
</body>
</html>
